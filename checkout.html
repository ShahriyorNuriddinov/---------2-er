<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LcM_dUrAAAAAI0IbC8udXlxfaWSWWbuMJwEbki"></script>

  <!-- AOS -->
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    .btn-animated{transition:all .3s ease}
    .btn-animated:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 8px 20px rgba(37,99,235,.4)}
    .icon-animated{transition:transform .3s ease}
    .icon-animated:hover,.btn-hover:hover .icon-animated{transform:scale(1.2) rotate(5deg)}
    /* Toast */
    .toast{position:fixed;top:1rem;right:1rem;min-width:250px;padding:12px 16px;border-radius:8px;color:#fff;font-weight:500;display:flex;align-items:center;gap:10px;opacity:0;transform:translateY(-20px);transition:opacity .3s ease,transform .3s ease;z-index:9999}
    .toast.show{opacity:1;transform:translateY(0)}
    .toast-success{background:#16a34a}
    .toast-error{background:#dc2626}
    .toast-info{background:#2563eb}
    .toast-warning{background:#d97706}
    /* –ö—Ä–∞—Å–∏–≤–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã –ø–æ —Å–ª–æ–≤–∞–º, –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–∞ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ */
    .no-ugly-wrap{word-break:normal;overflow-wrap:break-word;hyphens:manual}
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-6xl mx-auto p-6">

    <!-- –®–∞–ø–∫–∞ -->
    <div class="text-center mb-8" data-aos="fade-down">
      <h1 class="text-3xl font-bold">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
      <p class="text-gray-600">–ù–∞–¥—ë–∂–Ω–æ. –£–¥–æ–±–Ω–æ. –î–ª—è –≤–∞—Å.</p>
    </div>

    <div class="grid md:grid-cols-3 gap-6">
      <!-- –§–æ—Ä–º–∞ -->
      <form id="order-form" class="md:col-span-2 bg-white rounded-2xl shadow p-6 space-y-6" method="POST" action="send_order.php" data-aos="fade-right">
        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
        <div>
          <h2 class="text-xl font-semibold mb-3">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
          <div class="grid md:grid-cols-2 gap-4">
            <input type="text" placeholder="–ò–º—è" name="firstname" required class="border rounded-lg p-3 w-full focus:ring focus:ring-blue-200">
            <input type="text" placeholder="–§–∞–º–∏–ª–∏—è" name="lastname" required class="border rounded-lg p-3 w-full focus:ring focus:ring-blue-200">
            <input type="email" placeholder="Email" name="email" required class="border rounded-lg p-3 w-full focus:ring focus:ring-blue-200">
            <input type="tel" placeholder="+7 (999) 555-66-11" name="phone" required class="border rounded-lg p-3 w-full focus:ring focus:ring-blue-200">
          </div>
        </div>

        <!-- –ê–¥—Ä–µ—Å -->
        <div>
          <h2 class="text-xl font-semibold mb-3">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
          <textarea name="address" placeholder="–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" class="border rounded-lg p-3 w-full focus:ring focus:ring-blue-200"></textarea>
        </div>

        <!-- –û–ø–ª–∞—Ç–∞ -->
        <div data-aos="fade-up">
          <h2 class="text-xl font-semibold mb-3">–û–ø–ª–∞—Ç–∞</h2>
          <div class="space-y-2">
            <label class="flex items-center space-x-2">
              <input type="radio" name="payment" value="bank" class="accent-blue-500" checked>
              <span>–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ (—Ñ–∏–∑. –ª–∏—Ü–∞)</span>
            </label>
            <label class="flex items-center space-x-2">
              <input type="radio" name="payment" value="cash" class="accent-blue-500">
              <span>–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏</span>
            </label>
            <label class="flex items-center space-x-2">
              <input type="radio" name="payment" value="invoice" class="accent-blue-500">
              <span>–ë–µ–∑–Ω–∞–ª–∏—á–Ω—ã–π —Ä–∞—Å—á—ë—Ç (—é—Ä. –ª–∏—Ü–∞, –ù–î–° / –£–°–ù)</span>
            </label>
          </div>
        </div>

        <!-- –°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ -->
        <div data-aos="fade-up">
          <h2 class="text-xl font-semibold mb-3">–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É</h2>
          <div class="space-y-2" id="delivery-options">
            <label class="flex items-center space-x-2">
              <input type="radio" name="delivery" value="moscow" data-type="fixed" data-price="1000" class="accent-blue-500" checked>
              <span>üöö –ú–æ—Å–∫–≤–∞ ‚Äî –æ—Ç 1000 —Ä—É–±.</span>
            </label>
            <label class="flex items-center space-x-2">
              <input type="radio" name="delivery" value="mo" data-type="text" data-label="–ü–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é" class="accent-blue-500">
              <span>üì¶ –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (–∑–∞ –ú–ö–ê–î) ‚Äî –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é</span>
            </label>
            <label class="flex items-center space-x-2">
              <input type="radio" name="delivery" value="russia" data-type="text" data-label="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ –¢–ö" class="accent-blue-500">
              <span>üöõ –†–æ—Å—Å–∏—è ‚Äî <strong class="text-green-600">–ë–ï–°–ü–õ–ê–¢–ù–û</strong> –¥–æ –¢–ö (–ú–æ—Å–∫–≤–∞)</span>
            </label>
            <label class="flex items-center space-x-2">
              <input type="radio" name="delivery" value="pickup" data-type="text" data-label="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ" class="accent-blue-500">
              <span>üè¨ –°–∞–º–æ–≤—ã–≤–æ–∑ ‚Äî <strong class="text-green-600">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</strong></span>
            </label>
          </div>
          <div class="mt-4">
            <iframe src="https://yandex.ru/map-widget/v1/?um=constructor%3A3424ccb83e0b9da89a8c6d89fd5aa9d38a6b14363534ead12a3962743168f684&amp;source=constructor" width="100%" height="200" frameborder="0"></iframe>
          </div>
        </div>

        <input type="hidden" id="cart-data" name="cart-data">
        <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response">
      </form>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
      <div class="bg-white rounded-2xl shadow p-6 h-fit sticky top-6" data-aos="fade-left">
        <h2 class="text-xl font-semibold mb-4">–í–∞—à –∑–∞–∫–∞–∑</h2>
        <div id="cart-items" class="space-y-3"></div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏ -->
        <div class="mt-3">
          <button onclick="addInstallationService()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 rounded-lg btn-animated">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É –º–æ–Ω—Ç–∞–∂–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
          </button>
        </div>

        <!-- –ò—Ç–æ–≥–∏ -->
        <div class="space-y-2 border-t pt-3 mt-3">
          <div class="flex justify-between text-gray-600">
            <span>–¢–æ–≤–∞—Ä—ã:</span><span id="subtotal">0 ‚ÇΩ</span>
          </div>
          <div class="flex justify-between text-gray-600">
            <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span><span id="delivery-price">–æ—Ç 1000 ‚ÇΩ</span>
          </div>
          <div class="flex justify-between font-bold text-lg">
            <span>–ö –æ–ø–ª–∞—Ç–µ:</span><span id="total">0 ‚ÇΩ</span>
          </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="flex gap-2 mt-4">
          <button form="order-form" type="submit" class="btn-animated w-1/2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg">
            –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
          </button>
          <button onclick="clearCart()" class="w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg">
            –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
          </button>
        </div>

        <!-- –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç -->
        <p class="text-xs text-gray-500 text-center mt-3 leading-snug">
          –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏
          <a href="oferta.html" target="_blank" class="underline">–æ—Ñ–µ—Ä—Ç—ã</a>
          –∏ <a href="privacy.html" target="_blank" class="underline">–ø–æ–ª–∏—Ç–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a>.
        </p>

        <!-- –ü–æ–º–æ—â—å -->
        <div class="mt-6 bg-indigo-50 border border-indigo-200 p-5 rounded-xl shadow space-y-3">
          <div class="flex items-center gap-2 mb-2">
            <i data-lucide="help-circle" class="w-6 h-6 text-indigo-500"></i>
            <p class="text-base font-semibold text-indigo-700">–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –≤—ã–±–æ—Ä–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è?</p>
          </div>
          <p class="text-sm text-gray-700 leading-snug">–ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –ø–æ–º–æ–≥—É—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏. –í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:</p>

          <a href="https://wa.me/79055799233" target="_blank" class="btn-hover flex items-center justify-center gap-2 bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition">
            <i data-lucide="message-circle" class="icon-animated w-5 h-5"></i> WhatsApp
          </a>

          <a href="tel:+79055799233" class="btn-hover flex items-center justify-center gap-2 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition">
            <i data-lucide="phone" class="icon-animated w-5 h-5"></i> –ü–æ–∑–≤–æ–Ω–∏—Ç—å
          </a>

          <form method="POST" action="callback.php" class="space-y-2">
            <input type="tel" name="callback_phone" placeholder="–í–∞—à –Ω–æ–º–µ—Ä –¥–ª—è –∑–≤–æ–Ω–∫–∞" required class="border rounded-lg p-2 w-full">
            <button type="submit" class="btn-hover w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded-lg flex items-center justify-center gap-2">
              <i data-lucide="phone-call" class="icon-animated w-5 h-5"></i> –ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç–µ –º–Ω–µ
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
  <div id="toast-container"></div>

  <script>
    // reCAPTCHA
    grecaptcha.ready(function () {
      grecaptcha.execute('6LcM_dUrAAAAAI0IbC8udXlxfaWSWWbuMJwEbki', { action: 'order' })
        .then(function (token) { document.getElementById('g-recaptcha-response').value = token; });
    });

    // AOS
    AOS.init({ duration: 800, once: true });

    // Toast (–≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)
    function showToast(message, type = "info", duration = 4000) {
      const container = document.getElementById("toast-container");
      container.innerHTML = "";
      const toast = document.createElement("div");
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `<i data-lucide="info"></i><span>${message}</span>`;
      container.appendChild(toast);
      lucide.createIcons();
      setTimeout(() => toast.classList.add("show"), 100);
      setTimeout(() => { toast.classList.remove("show"); setTimeout(() => toast.remove(), 300); }, duration);
    }

    // –ö–æ—Ä–∑–∏–Ω–∞
    let cart = [
      { id: 1, name: "GRUNDFOS SQ 1-35", price: 120000, qty: 1, img: "https://via.placeholder.com/80?text=GRUNDFOS" }
    ];
    let deletedItems = {};
    let deliveryType = "fixed";
    let deliveryPrice = 1000;
    let deliveryLabel = "–æ—Ç 1000 ‚ÇΩ";

    function renderCart() {
      const container = document.getElementById("cart-items");
      container.innerHTML = "";
      let subtotal = 0;

      cart.forEach((item, index) => {
        const isService = item.id === 999;
        const itemTotal = item.price * item.qty;
        if (!isService) subtotal += itemTotal;

        const row = document.createElement("div");
        row.className = "flex items-start gap-3 border-b pb-3";

        if (deletedItems[item.id]) {
          row.innerHTML = `
            <div class="flex justify-between w-full items-center text-sm text-red-600">
              <span>–¢–æ–≤–∞—Ä "${item.name}" —É–¥–∞–ª—ë–Ω</span>
              <button onclick="restoreItem(${item.id})" class="text-blue-600 underline">
                –û—Ç–º–µ–Ω–∏—Ç—å (<span id="timer-${item.id}">${deletedItems[item.id].timer}</span>)
              </button>
            </div>`;
        } else {
          row.innerHTML = `
            <img src="${item.img}" class="w-12 h-12 rounded flex-shrink-0" alt="">
            <div class="flex-1 min-w-0">
              <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É —Å–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ -->
              <p class="no-ugly-wrap font-medium text-gray-800 leading-snug">
                ${item.name}
              </p>
              <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–µ–≤–∞, —Ü–µ–Ω–∞ –∏ –∫–æ—Ä–∑–∏–Ω–∞ —Å–ø—Ä–∞–≤–∞ -->
              <div class="mt-2 flex items-center justify-between">
                <input type="number" min="1" value="${item.qty}"
                  onchange="updateQty(${index}, this.value)"
                  class="w-16 border rounded p-1 text-center">
                <div class="flex items-center gap-2">
                  <p class="font-semibold text-gray-900 whitespace-nowrap">
                    ${isService ? "–ü–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é" : (itemTotal + " ‚ÇΩ")}
                  </p>
                  <button onclick="removeItem(${index})" class="text-red-500 hover:text-red-700">
                    <i data-lucide="trash-2"></i>
                  </button>
                </div>
              </div>
            </div>`;
        }

        container.appendChild(row);
      });

      document.getElementById("subtotal").innerText = subtotal + " ‚ÇΩ";
      if (deliveryType === "fixed") {
        document.getElementById("delivery-price").innerText = deliveryPrice + " ‚ÇΩ";
        document.getElementById("total").innerText = (subtotal + deliveryPrice) + " ‚ÇΩ";
      } else {
        document.getElementById("delivery-price").innerText = deliveryLabel;
        document.getElementById("total").innerText = subtotal + " ‚ÇΩ";
      }

      document.getElementById("cart-data").value = JSON.stringify(cart);
      lucide.createIcons();
    }

    function addInstallationService() {
      const exists = cart.find(i => i.id === 999);
      if (!exists) {
        cart.push({
          id: 999,
          name: "–ú–æ–Ω—Ç–∞–∂ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è",
          price: 0, // –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—É–º–º—É
          qty: 1,
          img: "https://via.placeholder.com/80?text=–ú–æ–Ω—Ç–∞–∂"
        });
        showToast("üõ†Ô∏è –£—Å–ª—É–≥–∞ –º–æ–Ω—Ç–∞–∂–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∑–∞–∫–∞–∑", "success");
      } else {
        showToast("‚ÑπÔ∏è –£—Å–ª—É–≥–∞ –º–æ–Ω—Ç–∞–∂–∞ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞", "info");
      }
      renderCart();
    }

    function removeItem(index) {
      const item = cart[index];
      deletedItems[item.id] = { ...item, timer: 9 };
      const countdown = setInterval(() => {
        if (deletedItems[item.id]) {
          deletedItems[item.id].timer--;
          const t = document.getElementById(`timer-${item.id}`);
          if (t) t.textContent = deletedItems[item.id].timer;
          if (deletedItems[item.id].timer <= 0) {
            clearInterval(countdown);
            cart = cart.filter(p => p.id !== item.id);
            delete deletedItems[item.id];
            renderCart();
            showToast(`üóëÔ∏è –¢–æ–≤–∞—Ä "${item.name}" –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª—ë–Ω`, "error");
          }
        }
      }, 1000);
      renderCart();
      showToast(`üóëÔ∏è –¢–æ–≤–∞—Ä "${item.name}" —É–¥–∞–ª—ë–Ω (–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)`, "warning");
    }

    function restoreItem(id) {
      if (deletedItems[id]) {
        showToast(`‚úÖ –¢–æ–≤–∞—Ä "${deletedItems[id].name}" –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`, "success");
        delete deletedItems[id];
        renderCart();
      }
    }

    function updateQty(index, qty) {
      cart[index].qty = Math.max(1, parseInt(qty || 1, 10));
      renderCart();
    }

    function clearCart() {
      cart = [];
      renderCart();
      showToast("üßπ –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞", "info");
    }

    // –î–æ—Å—Ç–∞–≤–∫–∞
    document.querySelectorAll('input[name="delivery"]').forEach(radio => {
      radio.addEventListener("change", function () {
        deliveryType = this.dataset.type;
        if (deliveryType === "fixed") {
          deliveryPrice = parseInt(this.dataset.price, 10);
          deliveryLabel = deliveryPrice + " ‚ÇΩ";
        } else {
          deliveryLabel = this.dataset.label;
        }
        renderCart();
      });
    });

    renderCart();

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    document.getElementById('order-form').addEventListener('submit', function (e) {
      const name = this.firstname.value.trim();
      const lastname = this.lastname.value.trim();
      const email = this.email.value.trim();
      const phone = this.phone.value.trim();

      const nameRegex = /^[–ê-–Ø–∞-—è–Å—ëA-Za-z\s\-]{2,20}$/;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
      const phoneRegex = /^\+7\d{10}$/;

      if (!nameRegex.test(name) || !nameRegex.test(lastname)) {
        e.preventDefault(); showToast("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é", "error");
      } else if (!emailRegex.test(email)) {
        e.preventDefault(); showToast("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email", "error");
      } else if (!phoneRegex.test(phone)) {
        e.preventDefault(); showToast("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ +79995556611", "error");
      } else {
        showToast("‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω", "success");
      }
    });
  </script>
</body>
</html>
